---
title: "Reproducible Research: Peer Assessment 1 - Final"
author: "Thomas MacPherson"
date: "2024-02-28"
output: html_document
---


## Loading and preprocessing the data
A copy of the data should be contained within the repository. 
Data was obtained from: https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip
Data was obtained on: "2024-02-28 08:18:16MST"
However, if the data is not contained please run the following code:

```{r downloading data,echo=TRUE}
## Code has been commented out because data should be already available in the repository
## fileurl<-https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip
## download.file(fileurl,destfile="./activity.zip"),method="curl"
## dateDownlaoded<-date()
```

First thing I want to do is unzip the file to .csv file so that we can read it into r.

```{r unzip file, echo=TRUE}
zipF<-"./activity.zip"
outDir<-"./"
unzip(zipF,exdir=outDir)
```

Now we will read the data into R to see what we are working with.

```{r read data, echo=TRUE}
data<-read.csv("./activity.csv")
dim(data)
str(data)
## Let's convert the Date into a Date format
data$date<-as.Date(as.character(data$date))
```

Looks like the data is clean and workable for now as the question says that we should ignore NA values for now.  

## What is mean total number of steps taken per day?

The goal of this section is to calculate the total number of steps taken per day (factor based on day) Make a histogram that shows the total number of steps taken per day. It is clarified that we don't want a bar chart, we want a frequency histogram of the total number of steps taken per day. We should also calculate and report the mean and median of the total number steps taken per day.

```{r Daily Total Steps,fig.height=4,echo=TRUE}
## Let's get rid of the NA values because they make things difficult
data1<-data[!is.na(data$steps),]
## Set the date as a factor variable so we can calculate total steps per day
data1$date<-as.factor(data1$date)
## Sum the data based on the factor using tapply
data1<-tapply(data1$steps,data1$date,FUN=sum)
## Plot a histogram showing how often we hit a certain number of steps per day
hist(data1,xlab="total steps per day",main="Frequency Based on Total Steps Per Day")
rug(data)
## Calculate the Mean and Median of total Steps taken per day
x<-summary(data1)
## Display the Mean steps taken per day
x[4]
## Display the Median steps taken per day
x[3]
```


## What is the average daily activity pattern?

Now that we have a general idea of the steps per day, we want to make a time series plot of the 5-minute intervals and the aberage number of steps taken, averaged across all days. Which interval contains the most steps when averaged across all of the days. To me, this is asking to factor based on interval and make a time series plot

```{r Average Steps per Interval, echo=TRUE}
## Let's get rid of the NA values because they make things difficult
data2<-data[!is.na(data$steps),]
## Set the interval as the factor variable so we can calculate average steps per interval
data2$interval<-as.factor(data2$interval)
## Average the steps based on the interval factor using tapply
data2<-tapply(data2$steps,data2$interval,FUN=mean)
## Create a time series plot
plot(names(data2),data2,type="l",xlab="Time of Day",ylab="Daily Average Steps",main="Most Active Times of Day")
## Let's find the maximum average steps based on interval
x<-summary(data2)
max<-as.numeric(x[6])
int<-names(data2[data2==max])
## the interval containing the highest average daily steps
int
```

So, we can see that 8:35am is the most active time when averaged over the time period with approximately 206 steps per day in the 5 min period. 

## Imputing missing values

In this step, we need to devise a strategy to fill in the missing values in our data set. i.e if NA make a value. I like the idea of finding the mean of that interval across the time period and replacing the NA values with those values. So we need to calculate the mean values for every interval (which we did in the last section). Then we have to about replacing the values.
So we need to find the NA value, determine what the interval is and use that interval to replace the NA value.

```{r Missing Values, echo=TRUE}
## Let's see how much missing data we have
steps<-data$steps
steps<-is.na(steps)
sum(steps)
## 2304 missing step entries
date<-data$date
date<-is.na(date)
sum(date)
## no missing dates 
interval<-data$interval
interval<-is.na(interval)
sum(interval)
## no missing intervals great.
library(dplyr)
data3<-data.frame()
for (x in names(data2)) {
  imputed<-replace(filter(data,interval==x)$steps,is.na(filter(data,interval==x)$steps),mean(filter(data,interval==x)$steps,na.rm=TRUE))
  u<-cbind(imputed,filter(data,interval==x))
  data3<-rbind(data3,u)
}
## rearrange to the original orginization
data3<-arrange(data3,date,interval)

```

## Are there differences in activity patterns between weekdays and weekends?